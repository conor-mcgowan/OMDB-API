<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
      crossorigin="anonymous"
    />

    <style>
      .hidden {
        visibility: hidden;
      }
      .redTxt {
        color: red;
      }
    </style>
  </head>
  <body>
    <form action="search">
      <label for="title">Title of Kino</label>
      <input type="text" name="title" id="title" />
      <div class="hidden redTxt" id="error1">
        Input must contain at least 3 characters.
      </div>
      <br />
      <label for="type">Type</label>
      <select name="type" id="type">
        <option>Movie</option>
        <option>Series</option>
        <option>Episode</option>
      </select>
      <br />
      <label for="year">Year of Release</label>
      <input type="number" name="year" id="year" min="1870" />
      <br />
      <input type="button" id="fetch" value="SEARCH" />
    </form>
    <br />
    <main>
      <div id="numResults"></div>
      <br />
      <div id="results"></div>
    </main>
    <script>
      document.getElementById("year").max = `${new Date().getFullYear()}`;
      let title = document.getElementById("title");
      let titleVal = title.value;
      let titleError = document.getElementById("error1");
      let typeVal = document.getElementById("type").value;
      let yearVal = document.getElementById("year").value;

      title.addEventListener("blur", () => {
        let value = title.value;
        if (value.length < 3) {
          titleError.style.visibility = "visible";
        } else {
          titleError.style.visibility = "hidden";
        }
      });

      title.addEventListener("keyup", (evt) => {
        if (evt.code == "Enter") {
          search();
        }
      });

      document.getElementById("fetch").addEventListener("click", () => {
        search();
      });
      function search() {
        let titleVal = document.getElementById("title").value;
        let typeVal = document.getElementById("type").value;
        let yearVal = document.getElementById("year").value;
        document.getElementById("results").innerHTML = ``;
        fetch(
          `http://www.omdbapi.com/?apikey=3dbeddda&s=${titleVal}&type=${typeVal}&y=${yearVal}`
        )
          .then((res) => res.json())
          .then((json) => {
            console.log(json);
            console.log(json.Search);
            if (json.success === false || titleVal.length < 3) {
              document.getElementById(
                "numResults"
              ).innerText = `Please check search parameters and try again.`;
              console.log(json);
              console.log(json.Search);
              return;
            }
            document.getElementById(
              "numResults"
            ).innerText = `${json.totalResults} results returned.`;
            json.Search.forEach((movie) => {
              movie.Title;
              movie.Year;
              movie.Type;
              document.getElementById("results").innerHTML += `
            <div>
                <h2>${movie.Title}</h2>
                <p>${movie.Year}</p>
                <p>${movie.Type}</p>
            </div>
            `;
            });
          });
      }
      src =
        "https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js";
      integrity =
        "sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW";
      crossorigin = "anonymous";
    </script>
  </body>
</html>
